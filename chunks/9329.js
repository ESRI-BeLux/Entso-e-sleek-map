"use strict";(self.webpackChunkentso_e_sleek_map_tester=self.webpackChunkentso_e_sleek_map_tester||[]).push([[9329],{50923:(e,t,r)=>{r.d(t,{Q:()=>n});var a=r(51324);async function n(e,t){const{loadContext:r,...n}=t||{},s=r?await r.fetchServiceMetadata(e,n):await(0,a.V)(e,n);c(s),l(s);const o={serviceJSON:s};if((s.currentVersion??0)<10.5)return o;const i=`${e}/layers`,u=r?await r.fetchServiceMetadata(i,n):await(0,a.V)(i,n);return c(u),l(u),o.layersJSON={layers:u.layers,tables:u.tables},o}function s(e){return"Feature Layer"===e.type||"Oriented Imagery Layer"===e.type}function o(e){return"Table"===e.type}function l(e){e.layers=e.layers?.filter(s),e.tables=e.tables?.filter(o)}function i(e){e.type||="Feature Layer"}function u(e){e.type||="Table"}function c(e){e.layers?.forEach(i),e.tables?.forEach(u)}},97435:(e,t,r)=>{r.d(t,{m:()=>o,v:()=>s});var a=r(31145),n=r(2344);function s(e,t){return{...l(e,t),readResourcePaths:[]}}function o(e,t,r){const n=(0,a.An)(e.itemUrl);return{...l(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function l(e,t){return{origin:t,url:(0,a.An)(e.itemUrl),portal:e.portal||n.A.getDefault(),portalItem:e}}},89329:(e,t,r)=>{r.d(t,{load:()=>m});var a=r(86173),n=r(90247),s=r(50923),o=r(53648),l=r(57893),i=r(55526),u=r(2344),c=r(97435),p=r(75127),y=r(93880),f=r(1664),d=r(51324);async function m(e,t){const r=e.instance.portalItem;if(r?.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new a.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),async function(e,t){const r=e.instance,n=r.portalItem;if(!n)return;const{url:i,title:u}=n,m=(0,c.v)(n,"portal-item");if("group"===r.type)return async function(e,t,r){const n=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:i,type:u}=n;if("Group Layer"===u){if(!(0,y.Y)(n,"Map"))throw new a.A("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e){const t=e.portalItem,r=await t.fetchData("json");if(!r)return;const a=(0,c.v)(t,"web-map");e.read(r,a),await(0,l.N)(e,r,{context:a}),e.resourceReferences={portalItem:t,paths:a.readResourcePaths??[]}}(e)}return e.read({title:i},t),async function(e,t){let r;const{portalItem:n}=e;if(!n)return;const l=n.type,i=t.layerModuleTypeMap;switch(l){case"Feature Service":case"Feature Collection":r=i.FeatureLayer;break;case"Stream Service":r=i.StreamLayer;break;case"Scene Service":r=i.SceneLayer;break;default:throw new a.A("portal:unsupported-item-type-as-group",`The item type '${l}' is not supported as a 'IGroupLayer'`)}const u=new o.v;let[c,y]=await Promise.all([r(),b(t,u)]),f=()=>c;if("Feature Service"===l){const t=(0,p.pJ)(y)?.customParameters;y=n.url?await(0,p.bO)(y,n.url,u):{};const r=(0,p.z8)(y),a=(0,p.ay)(y),o=(0,p.PC)(y),l=[];if(r.length||a?.length){r.length&&l.push("SubtypeGroupLayer"),a?.length&&l.push("OrientedImageryLayer"),o?.length&&l.push("CatalogLayer");const e=[];for(const t of l){const r=i[t];e.push(r())}const t=await Promise.all(e),n=new Map;l.forEach(((e,r)=>{n.set(e,t[r])})),f=e=>e.layerType?n.get(e.layerType)??c:c}const d=await async function(e,t){const{layersJSON:r}=await(0,s.Q)(e,t);if(!r)return null;const a=[...r.layers,...r.tables];return e=>a.find((t=>t.id===e.id))}(n.url,{customParameters:t,loadContext:u});return await h(e,f,y,d)}return"Scene Service"===l&&n.url&&(y=await(0,p.nu)(n,y,u)),(0,p.XH)(y)>0?await h(e,f,y):await async function(e,t){const{portalItem:r}=e;if(!r?.url)return;const a=await(0,d.V)(r.url);a&&h(e,t,{layers:a.layers?.map(p._r),tables:a.tables?.map(p._r)})}(e,f)}(e,r)}(r,m,e);i&&"media"!==r.type&&r.read({url:i},m);const w=new o.v,g=await b(e,w,t);return g&&r.read(g,m),r.resourceReferences={portalItem:n,paths:m.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:u},m),(0,f.L)(r,m)}(e,t)}async function h(e,t,r,a){let n=r.layers||[];const s=r.tables||[];if("Feature Collection"===e.portalItem?.type?(n.forEach(((e,t)=>{e.id=t,"Table"===e?.layerDefinition?.type&&s.push(e)})),n=n.filter((e=>"Table"!==e?.layerDefinition?.type))):(n.reverse(),s.reverse()),n.forEach((n=>{const s=a?.(n);if(s||!a){const a=w(e,t(n),r,n,s);e.add(a)}})),s.length){const t=await i.S.FeatureLayer();s.forEach((n=>{const s=a?.(n);if(s||!a){const a=w(e,t,r,n,s);e.tables.add(a)}}))}}function w(e,t,r,a,n){const s=e.portalItem,o={portalItem:s.clone(),layerId:a.id};null!=a.url&&(o.url=a.url);const l=new t(o);if("sourceJSON"in l&&(l.sourceJSON=n),"subtype-group"!==l.type&&"catalog"!==l.type&&(l.sublayerTitleMode="service-name"),"Feature Collection"===s.type){const e={origin:"portal-item",portal:s.portal||u.A.getDefault()};l.read(a,e);const t=r.showLegend;null!=t&&l.read({showLegend:t},e)}return l}async function b(e,t,r){if(!1===e.supportsData)return;const a=e.instance,s=a.portalItem;if(!s)return;let o=null;try{o=await s.fetchData("json",r)}catch(e){}if(function(e){return"stream"!==e.type&&"layerId"in e}(a)){let e=null;const r=await async function(e,t,r){if(t?.layers&&t?.tables)return(0,p.XH)(t);const a=(0,n.qg)(e.url);if(!a)return 1;const s=await r.fetchServiceMetadata(a.url.path,{customParameters:(0,p.pJ)(t)?.customParameters}).catch((()=>null));return(t?.layers?.length??s?.layers?.length??0)+(t?.tables?.length??s?.tables?.length??0)}(s,o,t);if((o?.layers||o?.tables)&&r>0){if(null==a.layerId){const e=(0,p.z8)(o);a.layerId="subtype-group"===a.type?e?.[0]:(0,p.WZ)(o)}e=function(e,t){const{layerId:r}=t,a=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return a&&function(e,t){return!("feature"===t.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===t.type&&!("layerType"in e))}(a,t)?a:null}(o,a),e&&null!=o.showLegend&&(e.showLegend=o.showLegend)}return r>1&&"sublayerTitleMode"in a&&"service-name"!==a.sublayerTitleMode&&(a.sublayerTitleMode="item-title-and-service-name"),e}return o}}}]);